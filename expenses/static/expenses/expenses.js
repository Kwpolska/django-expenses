!function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function a(e){var t=document.querySelector(e),n=parseInt(t.dataset.last_aid)+1;return t.dataset.last_aid=n.toString(),n}function i(e){return e.target.closest("tr")}function r(e){return isNaN(e)?r(0):new Intl.NumberFormat(_expConfig_.currencyLocale.replace("_","-"),{style:"currency",currency:_expConfig_.currencyCode}).format(e)}n.r(t);var l="expenses-autocomplete-hiding",o=function(){function e(e,t,n,a,i,r){this.input=e,this.name=void 0===t||null==t?e.name:t,this.url=n,this.hiddenByLength=!1,this.previousCount=0,this.keyboardSelection=-1,this.hideTimeout=null,this.entries=[],this.minLength=null==a?1:a,this.displayHandler=i,this.selectHandler=r,this.popperInstance=null,this.buildAcDiv()}return e.prototype.buildAcDiv=function(){this.acDiv=document.createElement("div");var e="acd_"+this.name.replace(".","");this.acDiv.className="dropdown-menu expenses-autocomplete-menu",this.acDiv.id=e,this.acDiv.addEventListener("mousedown",(function(e){e.stopPropagation(),e.preventDefault()})),this.input.setAttribute("autocomplete","off"),this.input.nextSibling?this.input.parentElement.insertBefore(this.acDiv,this.input.nextSibling):this.input.parentElement.appendChild(this.acDiv),0===this.minLength&&this.buildCompletions(null),this.addInputListeners()},e.prototype.addInputListeners=function(){var e=this;this.input.addEventListener("keydown",this.handleKeyDown.bind(this)),this.input.addEventListener("input",this.buildCompletions.bind(this)),this.input.addEventListener("change",this.buildCompletions.bind(this)),this.input.addEventListener("focus",(function(){return e.focusInput()})),this.input.addEventListener("blur",(function(){return e.blurInput()}))},e.prototype.buildCompletions=function(e){var t,n=this;t="string"!=typeof this.url?this.url():this.url;var a=this.input.value.trim();if("off"!==this.input.dataset.autocomplete){if(a.length<this.minLength)return this.hiddenByLength=!0,this.acDiv.innerHTML="",void this.hideAcDiv();this.hiddenByLength&&(this.unhideAcDiv(),this.hiddenByLength=!1),this.createPopper(),-1!==t.indexOf("?")?t+="&q="+encodeURIComponent(a):t+="?q="+encodeURIComponent(a);var i=this;fetch(t).then((function(e){return e.json()})).then((function(e){i.previousCount=i.entries.length,i.entries=e,i.acDiv.innerHTML="";var t=0;e.forEach((function(e){var n=document.createElement("button");n.type="button",n.className="dropdown-item",n.dataset.id=t.toString(),t++,n.innerText=i.getDisplayText(e),n.addEventListener("click",(function(t){return i.select(e)})),i.acDiv.appendChild(n)})),n.resetKeyboardSelection(),n.popperInstance.update()}))}},e.prototype.getDisplayText=function(e){return void 0!==this.displayHandler?this.displayHandler(e):e},e.prototype.select=function(e){var t=this;void 0!==this.selectHandler?this.selectHandler(e):this.input.value=this.getDisplayText(e),this.input.blur(),setTimeout((function(){return t.hideAcDiv()}),10)},e.prototype.focusInput=function(){""===this.input.value.trim()&&(this.acDiv.innerHTML=""),this.unhideAcDiv()},e.prototype.blurInput=function(){var e=this;setTimeout(function(){return e.hideAcDiv()}.bind(this),100)},e.prototype.unhideAcDiv=function(){null!==this.hideTimeout&&clearTimeout(this.hideTimeout),this.createPopper(),this.acDiv.classList.remove("expenses-autocomplete-hidden"),this.acDiv.classList.remove(l)},e.prototype.hideAcDiv=function(){var e=this;null!==this.hideTimeout&&clearTimeout(this.hideTimeout),this.acDiv.classList.add(l),this.hideTimeout=setTimeout(function(){e.acDiv.classList.remove(l),e.acDiv.classList.add("expenses-autocomplete-hidden"),e.destroyPopper()}.bind(this),110)},e.prototype.createPopper=function(){null==this.popperInstance&&(this.popperInstance=new Popper(this.input,this.acDiv,{placement:"bottom-start",modifiers:{flip:{enabled:!0}}}))},e.prototype.destroyPopper=function(){null!=this.popperInstance&&(this.popperInstance.destroy(),this.popperInstance=null)},e.prototype.handleKeyDown=function(e){"ArrowDown"===e.key?(this.setKeyboardSelection(this.keyboardSelection+1),e.preventDefault()):"ArrowUp"===e.key?(this.setKeyboardSelection(this.keyboardSelection-1),e.preventDefault()):"Enter"===e.key&&this.keyboardSelection>=0&&(this.select(this.entries[this.keyboardSelection]),this.setKeyboardSelection(null),e.preventDefault())},e.prototype.resetKeyboardSelection=function(){this.entries.length!==this.previousCount&&this.setKeyboardSelection(0)},e.prototype.setKeyboardSelection=function(e){if(this.acDiv.querySelectorAll("button").forEach((function(e){return e.classList.remove("active")})),null!==e){e<0&&(e=0),e>=this.entries.length&&(e=this.entries.length-1),this.keyboardSelection=e;var t=this.acDiv.querySelector('button[data-id="'+e+'"]');t.classList.add("active"),t.scrollIntoView()}else this.keyboardSelection=-1},e}();function s(e,t,n,a,i,r){var l="string"==typeof e?document.querySelector(e):e;if(null!==l&&null!=l)return new o(l,t,n,a,i,r)}var d=["expenses-billtable-serving","expenses-billtable-count","expenses-billtable-unitprice"];function c(e){u(i(e))}function u(e){var t=e.getElementsByClassName("expenses-billtable-unitprice")[0],n=e.getElementsByClassName("expenses-billtable-count")[0],a=t.getElementsByTagName("input")[0],i=n.getElementsByTagName("input")[0],l=e.getElementsByClassName("expenses-billtable-amount")[0],o=parseFloat(a.value)*parseFloat(i.value);l.innerText=r(o),l.dataset.value=o.toString(),p()}function p(){for(var e=document.querySelectorAll("td.expenses-billtable-amount"),t=0,n=0;n<e.length;n++){var a=parseFloat(e[n].dataset.value);isNaN(a)||(t+=a)}document.querySelector(".expenses-bill-total").innerText=r(t)}function m(){document.querySelector("#expenses-billtable-savechanges").disabled=!1}function b(e){var t={edit:{classNames:"btn-info expenses-billtable-btn-edit",title:gettext("Edit"),icon:"fa-edit",callback:y},undo:{classNames:"btn-warning expenses-billtable-btn-undo",title:gettext("Undo Changes"),icon:"fa-undo",callback:g},delete:{classNames:"btn-danger expenses-billtable-btn-delete",title:gettext("Delete"),icon:"fa-trash-alt",callback:x},accept:{classNames:"btn-success expenses-billtable-btn-accept",title:gettext("Accept"),icon:"fa-check",callback:S}};return function(e){var t=document.createElement("div");return t.className="btn-group",t.setAttribute("role","group"),t.setAttribute("aria-label",gettext("Item actions")),e.forEach((function(e){var n=document.createElement("button");n.type="button",n.className="btn "+e.classNames,n.title=e.title,n.innerHTML='<i class="fa fa-fw '+e.icon+'"></i>',n.addEventListener("click",e.callback),t.appendChild(n)})),t}(e.map((function(e){return t[e]})))}function h(){document.querySelector("#expenses-billtable-addrow .expenses-billtable-product input").focus()}function v(e){var t=document.querySelector("#expenses-billtable-addrow"),n=document.createElement("tr");n.classList.add("expenses-billtable-row","table-success");var i="a"+a("#expenses-billtable-form");n.dataset.id=i,f(n,t,i,"add",["edit","delete"]),t.getElementsByClassName("expenses-billtable-amount")[0].innerText=r(0),document.querySelector("#expenses-billtable tbody").insertBefore(n,t),t.querySelectorAll("input").forEach((function(e){void 0!==e.dataset.default?e.value=e.dataset.default:e.value=""})),delete t.querySelector(".expenses-billtable-amount").dataset.value,m(),h()}function f(e,t,n,a,i){e.dataset.type=a;for(var l=t.querySelectorAll("input"),o={},s=0;s<l.length;s++){var c=l[s];if(!c.reportValidity())throw new Error("Field "+c.name+" was invalid.");var u=document.createElement("td"),p=c.parentElement;p.dataset.hasOwnProperty("orig_text")&&(u.dataset.orig_text=p.dataset.orig_text,u.dataset.orig_value=p.dataset.orig_value),u.className=c.parentElement.className;var m=document.createElement("input");m.hidden=!0,m.value=c.value;var h=c.name;-1==h.indexOf("__")?m.name=n+"__"+h:m.name=h,u.appendChild(m);var v=c.value;"expenses-billtable-unitprice"==u.className&&(v=r(parseFloat(c.value)),u.dataset.value=c.value),u.appendChild(document.createTextNode(v)),e.appendChild(u),-1!=d.indexOf(u.className)?o[c.name]=parseFloat(c.value):o[c.name]=c.value}var f=t.getElementsByClassName("expenses-billtable-amount")[0],y=document.createElement("td");y.className="expenses-billtable-amount",y.innerText=f.innerText,y.dataset.value=f.dataset.value,f.dataset.hasOwnProperty("orig_text")&&(y.dataset.orig_text=f.dataset.orig_text,y.dataset.orig_value=f.dataset.orig_value),e.appendChild(y);var x=document.createElement("td");x.className="expenses-billtable-actions",x.innerHTML="",x.appendChild(b(i)),e.appendChild(x)}function y(e){for(var t=i(e),n=document.querySelector("#expenses-billtable-addrow"),a=0;a<t.children.length;a++){var r=t.children[a];if("expenses-billtable-actions"!=r.className){var l=r.getElementsByTagName("input"),o="";o=l.length>0?l[0].value:r.dataset.value?r.dataset.value:r.innerText.trim(),r.dataset.hasOwnProperty("orig_text")||(r.dataset.orig_text=r.innerText.trim(),r.dataset.orig_value=o.trim());var s=n.querySelector("."+r.className+" input");if(null!==s){var d=s.cloneNode(),u=d.name;d.value=o,d.name=t.dataset.id+"__"+u,"count"!=u&&"unit_price"!=u||d.addEventListener("input",c),d.addEventListener("keypress",L),r.innerHTML="",r.appendChild(d)}}else r.innerHTML="",r.appendChild(b(["accept","undo"]))}m(),e.preventDefault()}function x(e){var t=i(e),n=t.dataset.id;if("add"!==t.dataset.type){var a=document.querySelector("#expenses-billtable-deletions"),r=document.createElement("input");r.hidden=!0,r.name="d__"+n,a.appendChild(r)}t.remove(),p(),m(),e.preventDefault()}function g(e){var t=i(e);t.classList.remove("table-info"),t.querySelectorAll("td").forEach((function(e){e.dataset.hasOwnProperty("orig_text")&&(e.innerText=e.dataset.orig_text,e.dataset.value=e.dataset.orig_value),"expenses-billtable-actions"==e.className&&(e.innerHTML="",e.appendChild(b(["edit","delete"])))})),p(),e.preventDefault()}function S(e){E(i(e))}function E(e){var t=e.dataset.id,n=document.createElement("tr");n.classList.add("expenses-billtable-row","table-info"),n.dataset.id=t,f(n,e,t,function(e){return"a"==e.charAt(0)}(t)?"add":"edit",["edit","undo","delete"]),e.parentElement.replaceChild(n,e)}function q(){var e=document.querySelector("#expenses-billtable-addrow").querySelectorAll("input");e.forEach((function(e){return e.disabled=!0}));try{document.querySelectorAll(".expenses-billtable-btn-accept").forEach((function(e){return E(e.closest("tr"))})),document.querySelector("#expenses-billtable-form").submit()}catch(t){e.forEach((function(e){return e.disabled=!1})),event.preventDefault()}}function L(e){if(13==e.keyCode){if(e.metaKey||e.ctrlKey)q();else{var t=i(e);"expenses-billtable-addrow"===t.id?v():E(t)}return!1}}function k(e){var t=document.querySelector("#expenses-bulkcatedit-addrow"),n=document.createElement("tr");n.classList.add("table-success");for(var i="a"+a("#expenses-bulkcatedit-form"),r=t.querySelectorAll("input"),l=0;l<r.length;l++){var o=r[l];if(!o.reportValidity())throw new Error("Field "+o.name+" was invalid.");var s=document.createElement("td");s.className=o.closest("td").className;var d=o.cloneNode();d.name=d.name.replace("add_","add_"+i+"_"),d.addEventListener("keypress",T),s.appendChild(d),n.appendChild(s)}var c=document.createElement("td");c.className="expenses-bulkcatedit-actions";var u=document.createElement("btn");u.className="btn btn-danger",u.innerHTML='<i class="fa fa-fw fa-trash-alt"></i>',u.addEventListener("click",w),c.appendChild(u),n.appendChild(c),document.querySelector("#expenses-bulkcatedit-form tbody").insertBefore(n,t),r.forEach((function(e){return e.value=""}))}function w(e){i(e).remove()}function _(e){document.querySelectorAll("#expenses-bulkcatedit-addrow input").forEach((function(e){return e.disabled=!0}));var t=document.querySelector("#expenses-bulkcatedit-form");t.reportValidity()?t.submit():document.querySelectorAll("#expenses-bulkcatedit-addrow input").forEach((function(e){return e.disabled=!1})),null!==e&&e.preventDefault()}function T(e){if(13==e.keyCode){if("expenses-bulkcatedit-addrow"===i(e).id){var t=document.querySelector("#expenses-bulkcatedit-addrow").querySelectorAll("input");""===t[0].value&&""===t[1].value?_(null):k()}else _(null);return!1}}function D(e){var t=document.querySelector("#search-date-start"),n=document.querySelector("#search-date-end");document.querySelector("#search-date-spec-any").checked?(t.disabled=!0,n.disabled=!0):(t.disabled=!1,n.disabled=!1)}function C(e){var t=document.querySelector("#search-include-expenses"),n=document.querySelector("#search-include-bills");document.querySelector("#search-for-expenses").checked?(t.disabled=!1,n.disabled=!1):(t.disabled=!0,n.disabled=!0)}function N(e){e.amount.required="menu"!==e.type.value,e.amount.disabled="menu"===e.type.value}var A={},I=100;function O(e){var t=e.target,n=document.getElementById(t.dataset.target);n.disabled=!t.checked,t.checked&&n.focus()}document.addEventListener("DOMContentLoaded",(function(){
/*!
 * Expenses Scripting Enhancements
 * Copyright © 2018-2020, Chris Warrick. All rights reserved. License: 3-clause BSD.
 */
var e,t,n;if(s(".expenses-addform-vendor","vendor",(e=_expConfig_.baseUrl)+"api/autocomplete/expense/vendor/"),s(".expenses-billaddform-vendor","vendor",e+"api/autocomplete/bill/vendor/"),s(".expenses-addform-description","description",(function(){var t=document.querySelector(".expenses-addform-vendor").value.trim();return 0==t.length?e+"api/autocomplete/expense/description/":e+"api/autocomplete/expense/description/?vendor="+encodeURIComponent(t)})),null!==document.querySelector("#expenses-billtable-form")&&function(){var e=document.querySelector("#expenses-billtable-btn-add");e.type="button",e.addEventListener("click",v),document.querySelectorAll(".expenses-billtable-btn-edit").forEach((function(e){return e.addEventListener("click",y)})),document.querySelectorAll(".expenses-billtable-btn-delete").forEach((function(e){return e.addEventListener("click",x)})),document.querySelector("#expenses-billtable-addrow .expenses-billtable-unitprice input").addEventListener("input",c),document.querySelector("#expenses-billtable-addrow .expenses-billtable-count input").addEventListener("input",c),document.querySelector("#expenses-billtable-addrow .expenses-billtable-amount").innerText=r(0),document.querySelectorAll("#expenses-billtable-addrow input").forEach((function(e){return e.addEventListener("keydown",L)})),document.querySelector("#expenses-billtable-savechanges").addEventListener("click",q);var t=document.querySelector("#expenses-billtable-form");t.action="",t.dataset.last_aid="0";var n=document.querySelector("#expenses-billtable-addrow .expenses-billtable-product input");s(n,null,(function(){var e=document.querySelector("#expenses-bill-meta-vendor").innerText;return _expConfig_.baseUrl+"api/autocomplete/bill/item/?vendor="+encodeURIComponent(e)}),3,(function(e){var t=e;return"✨ "+t.product+" ⚖️"+t.serving+" 💶"+t.unit_price}),(function(e){var t=e,a=document.querySelector("#expenses-billtable-addrow");n.dataset.autocomplete="off",a.querySelector(".expenses-billtable-product input").value=t.product,a.querySelector(".expenses-billtable-serving input").value=t.serving.toString(),a.querySelector(".expenses-billtable-unitprice input").value=t.unit_price.toString(),n.dataset.autocomplete="on",u(a)})),h()}(),null!==document.querySelector("#expenses-bulkcatedit-form")&&function(){var e=document.querySelector("#expenses-bulkcatedit-btn-add");e.type="button",e.addEventListener("click",k),document.querySelectorAll("#expenses-bulkcatedit-addrow input").forEach((function(e){e.disabled=!1,e.addEventListener("keypress",T)})),document.querySelectorAll("#expenses-bulkcatedit-addrow input").forEach((function(e){return e.addEventListener("keypress",T)}));var t=document.querySelector("#expenses-bulkcatedit-btn-save");t.type="button",t.addEventListener("click",_),document.querySelector("#expenses-bulkcatedit-form").dataset.last_aid="0"}(),null!==document.querySelector("#expenses-templateedit-form")&&(t=document.querySelector("#expenses-templateedit-form"),n=function(){return N(t)},t.type.forEach((function(e){return e.addEventListener("change",n)})),N(t)),null!==document.querySelector("#expenses-search-form")&&(document.querySelector("#search-for-expenses").addEventListener("click",C),document.querySelector("#search-for-billitems").addEventListener("click",C),C(),document.querySelector("#search-date-spec-any").addEventListener("click",D),document.querySelector("#search-date-spec-between").addEventListener("click",D),D()),document.querySelectorAll(".expenses-field-enabler").forEach((function(e){e.addEventListener("click",O),document.getElementById(e.dataset.target).disabled=!e.checked})),-1!=navigator.userAgent.indexOf("ExpensesWebView")){var a=document.querySelector(".navbar-kw");a.classList.remove("static-top"),a.classList.add("fixed-top"),document.querySelector("body").style.paddingTop="50px"}document.body.addEventListener("touchstart",(function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t];n.pageX<=20&&(A[n.identifier]=n.pageX)}})),document.body.addEventListener("touchmove",(function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t];A.hasOwnProperty(n.identifier)&&(A[n.identifier],n.pageX-A[n.identifier]>=I&&($(".navbar-collapse").collapse("show"),window.scrollTo(0,0),delete A[n.identifier]))}})),document.body.addEventListener("touchend",(function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t];A.hasOwnProperty(n.identifier)&&(A[n.identifier],n.pageX-A[n.identifier]>=I&&($(".navbar-collapse").collapse("show"),window.scrollTo(0,0)),delete A[n.identifier])}}))}),!1)}]);